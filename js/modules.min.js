"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),socket=io("https://easycode-test-chat.herokuapp.com"),Chat=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"setEvents",value:function(){socket.on("chatMessage",function(e,t){chat.renderMessage(e,t)}),socket.on("writeMessage",function(e){console.log("writing",e)}),messageForm.addEventListener("submit",function(e){if(e.preventDefault(),""===inputMessage.value)return console.log("Empty message");chat.sendMessage(inputMessage.value,userInfo),inputMessage.value=""}),inputMessage.addEventListener("keyup",function(e){chat.writeMessage("by "+userInfo.name)})}},{key:"verify",value:function(e){new Promise(function(t,n){console.log(e),socket.emit("verify",e,function(e,s){e?n(error):t(s)})}).then(function(e){userInfo=e,localStorage.email=e.email,localStorage.name=e.name}).then(function(){document.querySelector("#header .user-info .user-data .user-name").innerHTML=""+e.name,enterModal.hide()}).then(chat.getUsers).then(chat.renderUsers).then(chat.setEvents).then(loader.classList.add("hide")).catch(function(e){return console.error(e)})}},{key:"getUsers",value:function(){return new Promise(function(e,t){socket.emit("getUsers",function(n){n||t("Users not found"),e(n)})})}},{key:"sendMessage",value:function(e,t){socket.emit("chatMessage",e,t)}},{key:"writeMessage",value:function(e){socket.emit("writeMessage",e)}},{key:"renderUsers",value:function(e){var t=document.querySelector(".chat-rooms-list");e.forEach(function(e){var n='\n                    <div class="chat-room-item d-flex align-items-center">\n\t\t\t\t\t\t<div class="chat-room-user-ava">\n\t\t\t\t\t\t\t<img src="img/chat-img.png" alt="">\n\t\t\t\t\t\t\t<span class="new-msg-count"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="chat-room-user-info">\n\t\t\t\t\t\t\t<span class="chat-room-user-name">'+e.name+'</span>\n\t\t\t\t\t\t\t<div class="chat-room-last-msg d-flex justify-content-between">\n\t\t\t\t\t\t\t\t<span class="last-msg">'+e.lastMessage+'</span>\n\t\t\t\t\t\t\t\t<span class="last-msg-time">1 min</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="chat-room-user-status '+(e.isOnline?"online":"offline")+'"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n        ';t.insertAdjacentHTML("beforeend",n)})}},{key:"renderMessage",value:function(e,t){var n=document.querySelector(".message-container"),s=document.createElement("div");s.classList.add("message"),userInfo.name===t.name&&userInfo.email===t.email?s.classList.add("from-you"):s.classList.add("to-you"),s.innerHTML='<img src="img/chat-img.png">\n                            <div class="message-text">'+e+"</div>",n.appendChild(s)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),Modal=function(){function e(t){_classCallCheck(this,e),this.modal=document.querySelector(t),this.overlay=document.querySelector(".overlay")}return _createClass(e,[{key:"show",value:function(){this.modal.classList.add("show"),this.overlay.classList.add("show")}},{key:"hide",value:function(){this.modal.classList.remove("show"),this.overlay.classList.remove("show")}}]),e}();